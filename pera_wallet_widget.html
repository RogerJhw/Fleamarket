<!DOCTYPE html>
<html>
<head>
  <title>Pera Wallet Connect Widget</title>
  <script src="https://unpkg.com/@perawallet/connect"></script>
</head>
<body>
  <button id="connect-button">Connect Pera Wallet</button>
  <p id="wallet-address"></p>

  <script>
    const button = document.getElementById("connect-button");
    const output = document.getElementById("wallet-address");
    let peraWallet;

    async function connectWallet() {
      try {
        peraWallet = new window.PeraWalletConnect();

        const accounts = await peraWallet.connect();
        const address = accounts[0];

        output.textContent = `Connected address: ${address}`;

        // Send wallet address to Streamlit backend
        const streamlitMsg = {
          isStreamlitMessage: true,
          type: "setWallet",
          address: address
        };
        window.parent.postMessage(streamlitMsg, "*");
      } catch (err) {
        output.textContent = `Connection failed: ${err.message}`;
      }
    }

    button.addEventListener("click", connectWallet);
  </script>
</body>
</html>
